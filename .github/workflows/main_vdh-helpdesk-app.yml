# Replace the existing deploy job/step(s) in your workflow with the block below.
# This ensures the workflow checks out the full repository and deploys the entire workspace
# (package: '.') so the fleet/ folder and other repo files are included on the Web App.
#
# Paste this block to replace the current `deploy:` job (the block that starts with
# "deploy:" around line ~50 in your file). Keep the surrounding `jobs:` structure intact.
deploy:
  runs-on: ubuntu-latest
  needs: build
  permissions:
    id-token: write    # required by actions/checkout for requesting OIDC tokens if used
    contents: read     # required for actions/checkout
  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Download artifact from build job
      uses: actions/download-artifact@v4
      with:
        name: python-app

    - name: Login to Azure
      uses: azure/login@v2
      with:
        # Keep the same secret names you use in the workflow or replace with your secrets
        client-id: ${{ secrets.AZUREAPPSERVICE_CLIENTID_33166D5647ED44B795D7F269B82B9993 }}
        tenant-id: ${{ secrets.AZUREAPPSERVICE_TENANTID_A5F45344A20F4DB7845FF98C82E44B3 }}
        subscription-id: ${{ secrets.AZUREAPPSERVICE_SUBSCRIPTIONID_EB69425F801B4EAD9D3C7CA5719177CD }}

    - name: 'Deploy to Azure Web App'
      uses: azure/webapps-deploy@v3
      id: deploy-to-webapp
      with:
        app-name: 'Vdh-helpdesk-app'
        publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}
        package: '.'            # deploy the entire checked-out workspace (includes fleet/)
        slot-name: 'Production'
